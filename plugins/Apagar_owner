let handler = async (m, { conn, isOwner }) => {
  if (!isOwner) return m.reply('ğŸš« Este comando solo puede ser usado por el *Owner*.')
  
  await conn.sendMessage(m.chat, {
    text: 'âš ï¸ Â¿EstÃ¡s seguro de que quieres *apagar* el bot?\n\nPresiona el botÃ³n si estÃ¡s completamente seguro.',
    footer: 'Este proceso detendrÃ¡ el bot hasta que se reinicie manualmente.',
    buttons: [
      { buttonId: '.confirmar_apagado', buttonText: { displayText: 'âœ… Confirmar apagado' }, type: 1 }
    ],
    headerType: 1
  }, { quoted: m })
}

let confirmarHandler = async (m, { conn, isOwner }) => {
  if (!isOwner) return m.reply('ğŸš« Solo el Owner puede confirmar el apagado.')

  const frames = [
    'ğŸ”´ Apagando.',
    'ğŸŸ  Apagando..',
    'ğŸŸ¡ Apagando...',
    'ğŸŸ¢ Cerrando servicios.',
    'ğŸ”µ Guardando base de datos.',
    'ğŸŸ£ Terminando procesos.',
    'âš« Apagado completo.'
  ]

  let { key } = await conn.sendMessage(m.chat, { text: frames[0] }, { quoted: m })

  for (let i = 1; i < frames.length; i++) {
    await new Promise(resolve => setTimeout(resolve, 700))
    await conn.sendMessage(m.chat, { text: frames[i], edit: key })
  }

  await new Promise(resolve => setTimeout(resolve, 1000))
  await m.reply('ğŸ›‘ Bot apagado exitosamente. ReinÃ­cialo manualmente para volver a encenderlo.')

  process.exit()
}

// Comando inicial para mostrar el botÃ³n
handler.command = /^apagar$/i
handler.owner = true
handler.group = false

// Comando oculto para confirmar
export const confirmHandler = {
  command: /^confirmar_apagado$/i,
  owner: true,
  handler: confirmarHandler
}

export default handler 
